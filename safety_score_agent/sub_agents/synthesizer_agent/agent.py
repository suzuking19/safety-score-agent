from typing import Dict, Any, Optional
from google.adk.agents import LlmAgent

# --- Constants ---
GEMINI_MODEL = "gemini-2.0-flash"
MAX_SCORE_PER_CATEGORY = 25
TOTAL_MAX_SCORE = 100
NUM_CATEGORIES = 4


class SafetyScoreCategories:
    """å®‰å…¨ã‚¹ã‚³ã‚¢è©•ä¾¡ã‚«ãƒ†ã‚´ãƒªã®å®šç¾©"""
    CONFLICT = "conflict"
    CRIME = "crime"
    INFRASTRUCTURE = "infrastructure"
    LAW_ENFORCEMENT = "law_enforcement"


class SafetyScoreThresholds:
    """å®‰å…¨ãƒ¬ãƒ™ãƒ«ã®é–¾å€¤å®šç¾©"""
    EXCELLENT = 90
    GOOD = 70
    AVERAGE = 50
    CAUTION = 30
    DANGEROUS = 0


class SafetyScoreLevels:
    """å®‰å…¨ãƒ¬ãƒ™ãƒ«ãƒ©ãƒ™ãƒ«"""
    EXCELLENT = "å„ªç§€"
    GOOD = "è‰¯å¥½"
    AVERAGE = "æ™®é€š"
    CAUTION = "æ³¨æ„"
    DANGEROUS = "å±é™º"


class SafetyScoreSynthesizerAgent:
    """å®‰å…¨ã‚¹ã‚³ã‚¢çµ±åˆè©•ä¾¡ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ"""
    
    def __init__(self):
        self.categories = SafetyScoreCategories()
        self.thresholds = SafetyScoreThresholds()
        self.levels = SafetyScoreLevels()
        self.agent = self._create_agent()
    
    def _create_agent(self) -> LlmAgent:
        """LlmAgentã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ"""
        return LlmAgent(
            name="SafetyScoreSynthesizer",
            model=GEMINI_MODEL,
            instruction=self._build_instruction(),
            description="4ã¤ã®å°‚é–€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‹ã‚‰ã®å®‰å…¨æƒ…å ±ã‚’çµ±åˆã—ã€ç·åˆå®‰å…¨ã‚¹ã‚³ã‚¢ï¼ˆ100ç‚¹æº€ç‚¹ï¼‰ã‚’ç®—å‡ºã—ã¾ã™",
        )
    
    def _build_instruction(self) -> str:
        """ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®æŒ‡ç¤ºæ–‡ã‚’æ§‹ç¯‰"""
        return f"""ã‚ãªãŸã¯é«˜åº¦ãªå®‰å…¨ã‚¹ã‚³ã‚¢çµ±åˆè©•ä¾¡ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ã™ã€‚

## ğŸ¯ ä¸»è¦ä»»å‹™
4ã¤ã®å°‚é–€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‹ã‚‰å–å¾—ã—ãŸå¤šè§’çš„ãªå®‰å…¨æƒ…å ±ã‚’ç·åˆçš„ã«åˆ†æãƒ»è©•ä¾¡ã—ã€æŒ‡å®šã•ã‚ŒãŸå›½ãƒ»åœ°åŸŸã®ç·åˆå®‰å…¨ã‚¹ã‚³ã‚¢ï¼ˆ{TOTAL_MAX_SCORE}ç‚¹æº€ç‚¹ï¼‰ã‚’ç§‘å­¦çš„ã‹ã¤å®¢è¦³çš„ã«ç®—å‡ºã—ã¾ã™ã€‚

## ğŸ“¥ å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹
å„å°‚é–€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‹ã‚‰ã®è©³ç´°æƒ…å ±ã‚’çµ±åˆå‡¦ç†ã—ã¾ã™ï¼š
- **ãƒ†ãƒ­ãƒ»ç´›äº‰ãƒªã‚¹ã‚¯æƒ…å ±**: {{conflict_info}}
  - å¤–å‹™çœå±é™ºãƒ¬ãƒ™ãƒ«ã€ãƒ†ãƒ­çµ„ç¹”å‹•å‘ã€æ­¦åŠ›è¡çªãƒ‡ãƒ¼ã‚¿ã€æ”¿æ²»ä¸å®‰å®šåº¦æŒ‡æ¨™
- **çŠ¯ç½ªãƒ»æ²»å®‰æƒ…å ±**: {{crime_info}}
  - çŠ¯ç½ªçµ±è¨ˆã€æ²»å®‰å½“å±€å¯¾å¿œèƒ½åŠ›ã€è¡—é ­çŠ¯ç½ªç‡ã€è¦³å…‰å®¢è¢«å®³ãƒ‡ãƒ¼ã‚¿
- **ç¤¾ä¼šåŸºç›¤å®‰å®šåº¦æƒ…å ±**: {{infra_info}}
  - æ”¿æ²»è…æ•—æŒ‡æ•°ã€äº¤é€šå®‰å…¨çµ±è¨ˆã€åŒ»ç™‚ã‚·ã‚¹ãƒ†ãƒ è©•ä¾¡ã€çµŒæ¸ˆå®‰å®šæ€§æŒ‡æ¨™
- **æ³•åŸ·è¡Œæ©Ÿé–¢ä¿¡é ¼æ€§æƒ…å ±**: {{law_info}}
  - è­¦å¯Ÿä¿¡é ¼åº¦èª¿æŸ»ã€å¸æ³•åˆ¶åº¦è©•ä¾¡ã€æ±šè·åº¦æ¸¬å®šã€æ³•ã®æ”¯é…æŒ‡æ•°

## ğŸ§  åˆ†æã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
1. **å¤šæ¬¡å…ƒãƒ‡ãƒ¼ã‚¿çµ±åˆ**: å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®æƒ…å ±ã‚’ç›¸äº’é–¢é€£æ€§ã‚’è€ƒæ…®ã—ã¦çµ±åˆ
2. **ãƒªã‚¹ã‚¯é‡ã¿ä»˜ã‘è©•ä¾¡**: æ—…è¡Œè€…ã¸ã®å®Ÿéš›ã®å½±éŸ¿åº¦ã«åŸºã¥ãé‡è¦åº¦èª¿æ•´
3. **å‹•çš„è©•ä¾¡èª¿æ•´**: æœ€æ–°æƒ…å‹¢å¤‰åŒ–ã‚’åæ˜ ã—ãŸæŸ”è»Ÿãªã‚¹ã‚³ã‚¢ç®—å‡º
4. **äºˆæ¸¬çš„ãƒªã‚¹ã‚¯åˆ†æ**: ç¾åœ¨ã®ãƒˆãƒ¬ãƒ³ãƒ‰ã‹ã‚‰å°†æ¥ãƒªã‚¹ã‚¯ã‚’äºˆæ¸¬
5. **åœ°åŸŸç‰¹æ€§è€ƒæ…®**: æ–‡åŒ–çš„ãƒ»åœ°ç†çš„ç‰¹æ€§ã‚’è¸ã¾ãˆãŸå€‹åˆ¥è©•ä¾¡

{self._get_evaluation_criteria()}

{self._get_output_format()}

{self._get_evaluation_guidelines()}

## ğŸ” å“è³ªä¿è¨¼è¦ä»¶
- ãƒ‡ãƒ¼ã‚¿ã®ä¿¡é ¼æ€§ã¨æœ€æ–°æ€§ã‚’å¸¸ã«æ¤œè¨¼
- ãƒã‚¤ã‚¢ã‚¹ã‚’æ’é™¤ã—ãŸå®¢è¦³çš„è©•ä¾¡ã®å®Ÿæ–½
- æ˜ç¢ºãªæ ¹æ‹ ã«åŸºã¥ãé€æ˜æ€§ã®é«˜ã„è©•ä¾¡ãƒ—ãƒ­ã‚»ã‚¹
- å®Ÿç”¨æ€§ã¨ç²¾åº¦ã®ãƒãƒ©ãƒ³ã‚¹ã‚’é‡è¦–ã—ãŸå®Ÿè·µçš„æè¨€ã®æä¾›
"""
    
    def _get_evaluation_criteria(self) -> str:
        """è©•ä¾¡åŸºæº–ã‚’å–å¾—"""
        return f"""## ğŸ“Š è©³ç´°è©•ä¾¡åŸºæº–ï¼ˆå„{MAX_SCORE_PER_CATEGORY}ç‚¹æº€ç‚¹ï¼‰

### 1. ğŸš¨ ãƒ†ãƒ­ãƒ»ç´›äº‰ãƒªã‚¹ã‚¯è©•ä¾¡ ({MAX_SCORE_PER_CATEGORY}ç‚¹æº€ç‚¹)
**è©•ä¾¡è¦ç´ **: å¤–å‹™çœå±é™ºãƒ¬ãƒ™ãƒ«ã€ãƒ†ãƒ­çµ„ç¹”æ´»å‹•çŠ¶æ³ã€æ­¦åŠ›è¡çªãƒªã‚¹ã‚¯ã€æ”¿æ²»ä¸å®‰å®šåº¦
- **25ç‚¹**: å±é™ºãƒ¬ãƒ™ãƒ«1ã€ãƒ†ãƒ­æ´»å‹•ãªã—ã€æ”¿æ²»çš„å®‰å®š
- **20ç‚¹**: å±é™ºãƒ¬ãƒ™ãƒ«2ã€è»½å¾®ãªãƒ†ãƒ­ãƒªã‚¹ã‚¯ã€æ”¿æ²»çš„æ‘©æ“¦ã‚ã‚Š
- **15ç‚¹**: å±é™ºãƒ¬ãƒ™ãƒ«3ã€ä¸­ç¨‹åº¦ã®ãƒ†ãƒ­ãƒªã‚¹ã‚¯ã€åœ°åŸŸçš„ç´›äº‰å¯èƒ½æ€§
- **10ç‚¹**: å±é™ºãƒ¬ãƒ™ãƒ«4ã€é«˜ãƒ†ãƒ­ãƒªã‚¹ã‚¯ã€æ­¦åŠ›è¡çªç™ºç”Ÿä¸­
- **5ç‚¹**: å±é™ºãƒ¬ãƒ™ãƒ«4ä»¥ä¸Šã€æ¥µé«˜ãƒ†ãƒ­ãƒªã‚¹ã‚¯ã€å…¨é¢çš„æ­¦åŠ›è¡çª

### 2. ğŸ” çŠ¯ç½ªãƒ»æ²»å®‰è©•ä¾¡ ({MAX_SCORE_PER_CATEGORY}ç‚¹æº€ç‚¹)
**è©•ä¾¡è¦ç´ **: å‡¶æ‚ªçŠ¯ç½ªç‡ã€è»½çŠ¯ç½ªç‡ã€æ²»å®‰ç¶­æŒèƒ½åŠ›ã€è¦³å…‰å®¢è¢«å®³çŠ¶æ³
- **25ç‚¹**: ä¸–ç•Œæœ€é«˜æ°´æº–ã®æ²»å®‰ã€çŠ¯ç½ªç‡æ¥µä½ã€åŠ¹æœçš„ãªæ²»å®‰ç¶­æŒ
- **20ç‚¹**: å„ªç§€ãªæ²»å®‰çŠ¶æ³ã€ä½çŠ¯ç½ªç‡ã€é©åˆ‡ãªè­¦å¯Ÿå¯¾å¿œ
- **15ç‚¹**: å¹³å‡çš„æ²»å®‰æ°´æº–ã€ä¸­ç¨‹åº¦çŠ¯ç½ªç‡ã€æ¨™æº–çš„è­¦å¯Ÿæ©Ÿèƒ½
- **10ç‚¹**: ã‚„ã‚„å±é™ºãªæ²»å®‰çŠ¶æ³ã€é«˜çŠ¯ç½ªç‡ã€è­¦å¯Ÿå¯¾å¿œã«èª²é¡Œ
- **5ç‚¹**: æ·±åˆ»ãªæ²»å®‰æ‚ªåŒ–ã€æ¥µé«˜çŠ¯ç½ªç‡ã€æ²»å®‰ç¶­æŒæ©Ÿèƒ½ä¸å…¨

### 3. ğŸ—ï¸ ç¤¾ä¼šåŸºç›¤å®‰å®šåº¦è©•ä¾¡ ({MAX_SCORE_PER_CATEGORY}ç‚¹æº€ç‚¹)
**è©•ä¾¡è¦ç´ **: æ”¿æ²»è…æ•—åº¦ã€äº¤é€šå®‰å…¨ã€åŒ»ç™‚æ°´æº–ã€çµŒæ¸ˆå®‰å®šæ€§ã€ç½å®³å¯¾å¿œèƒ½åŠ›
- **25ç‚¹**: é€æ˜æ€§é«˜ã„æ”¿æ²»ã€å„ªç§€ãªäº¤é€šãƒ»åŒ»ç™‚ã€å¼·å›ºãªçµŒæ¸ˆåŸºç›¤
- **20ç‚¹**: æ”¿æ²»çš„å®‰å®šã€è‰¯å¥½ãªç¤¾ä¼šã‚¤ãƒ³ãƒ•ãƒ©ã€å®‰å®šã—ãŸçµŒæ¸ˆ
- **15ç‚¹**: ä¸­ç¨‹åº¦ã®æ”¿æ²»è…æ•—ã€å¹³å‡çš„ã‚¤ãƒ³ãƒ•ãƒ©ã€æ¨™æº–çš„çµŒæ¸ˆçŠ¶æ³
- **10ç‚¹**: æ”¿æ²»è…æ•—å•é¡Œã€ã‚¤ãƒ³ãƒ•ãƒ©èª²é¡Œã€çµŒæ¸ˆä¸å®‰å®šè¦ç´ 
- **5ç‚¹**: æ·±åˆ»ãªæ”¿æ²»è…æ•—ã€ã‚¤ãƒ³ãƒ•ãƒ©æ©Ÿèƒ½ä¸å…¨ã€çµŒæ¸ˆå±æ©ŸçŠ¶æ…‹

### 4. âš–ï¸ æ³•åŸ·è¡Œæ©Ÿé–¢ä¿¡é ¼æ€§è©•ä¾¡ ({MAX_SCORE_PER_CATEGORY}ç‚¹æº€ç‚¹)
**è©•ä¾¡è¦ç´ **: è­¦å¯Ÿä¿¡é ¼åº¦ã€æ±šè·åº¦åˆã„ã€å¸æ³•åˆ¶åº¦æ©Ÿèƒ½ã€äººæ¨©ä¿è­·æ°´æº–
- **25ç‚¹**: å›½éš›çš„ã«ä¿¡é ¼ã•ã‚Œã‚‹æ³•åŸ·è¡Œæ©Ÿé–¢ã€é€æ˜ãªå¸æ³•åˆ¶åº¦
- **20ç‚¹**: é«˜ã„è­¦å¯Ÿä¿¡é ¼åº¦ã€åŠ¹æœçš„ãªå¸æ³•ã‚·ã‚¹ãƒ†ãƒ ã€é©åˆ‡ãªäººæ¨©ä¿è­·
- **15ç‚¹**: å¹³å‡çš„ãªæ³•åŸ·è¡Œæ©Ÿé–¢ã€æ¨™æº–çš„å¸æ³•æ©Ÿèƒ½ã€åŸºæœ¬çš„äººæ¨©ä¿è­·
- **10ç‚¹**: è­¦å¯Ÿã¸ã®ä¸ä¿¡ã€å¸æ³•åˆ¶åº¦ã®èª²é¡Œã€äººæ¨©å•é¡Œã®å­˜åœ¨
- **5ç‚¹**: æ³•åŸ·è¡Œæ©Ÿé–¢ã¸ã®æ·±åˆ»ãªä¸ä¿¡ã€å¸æ³•åˆ¶åº¦æ©Ÿèƒ½ä¸å…¨ã€äººæ¨©ä¾µå®³"""
    
    def _get_output_format(self) -> str:
        """å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’å–å¾—"""
        return f"""å‡ºåŠ›å½¢å¼:
## ğŸŒ ç·åˆå®‰å…¨ã‚¹ã‚³ã‚¢è©•ä¾¡ãƒ¬ãƒãƒ¼ãƒˆ

### ğŸ“Š ç·åˆè©•ä¾¡
- **ç·åˆå®‰å…¨ã‚¹ã‚³ã‚¢**: XX/{TOTAL_MAX_SCORE}ç‚¹
- **å®‰å…¨ãƒ¬ãƒ™ãƒ«**: [{self.levels.EXCELLENT}({self.thresholds.EXCELLENT}-{TOTAL_MAX_SCORE}ç‚¹)/{self.levels.GOOD}({self.thresholds.GOOD}-89ç‚¹)/{self.levels.AVERAGE}({self.thresholds.AVERAGE}-69ç‚¹)/{self.levels.CAUTION}({self.thresholds.CAUTION}-49ç‚¹)/{self.levels.DANGEROUS}({self.thresholds.DANGEROUS}-29ç‚¹)]

### ğŸ“‹ è©³ç´°è©•ä¾¡

#### 1. ãƒ†ãƒ­ãƒ»ç´›äº‰ãƒªã‚¹ã‚¯è©•ä¾¡: XX/{MAX_SCORE_PER_CATEGORY}ç‚¹
**è©•ä¾¡ç†ç”±**: [å–å¾—ã—ãŸæƒ…å ±ã«åŸºã¥ãå…·ä½“çš„ãªè©•ä¾¡æ ¹æ‹ ]
**ä¸»è¦ãƒªã‚¹ã‚¯**: [ç‰¹å®šã•ã‚ŒãŸãƒªã‚¹ã‚¯è¦å› ]

#### 2. çŠ¯ç½ªãƒ»æ²»å®‰è©•ä¾¡: XX/{MAX_SCORE_PER_CATEGORY}ç‚¹  
**è©•ä¾¡ç†ç”±**: [å–å¾—ã—ãŸæƒ…å ±ã«åŸºã¥ãå…·ä½“çš„ãªè©•ä¾¡æ ¹æ‹ ]
**ä¸»è¦ãƒªã‚¹ã‚¯**: [ç‰¹å®šã•ã‚ŒãŸãƒªã‚¹ã‚¯è¦å› ]

#### 3. ç¤¾ä¼šåŸºç›¤å®‰å®šåº¦è©•ä¾¡: XX/{MAX_SCORE_PER_CATEGORY}ç‚¹
**è©•ä¾¡ç†ç”±**: [å–å¾—ã—ãŸæƒ…å ±ã«åŸºã¥ãå…·ä½“çš„ãªè©•ä¾¡æ ¹æ‹ ]
**ä¸»è¦èª²é¡Œ**: [ç‰¹å®šã•ã‚ŒãŸèª²é¡Œ]

#### 4. æ³•åŸ·è¡Œæ©Ÿé–¢ä¿¡é ¼æ€§è©•ä¾¡: XX/{MAX_SCORE_PER_CATEGORY}ç‚¹
**è©•ä¾¡ç†ç”±**: [å–å¾—ã—ãŸæƒ…å ±ã«åŸºã¥ãå…·ä½“çš„ãªè©•ä¾¡æ ¹æ‹ ]
**ä¿¡é ¼æ€§èª²é¡Œ**: [ç‰¹å®šã•ã‚ŒãŸèª²é¡Œ]

### ğŸš¨ ç·åˆçš„ãªå®‰å…¨å¯¾ç­–æè¨€
[å„é …ç›®ã®è©•ä¾¡çµæœã‚’è¸ã¾ãˆãŸç·åˆçš„ãªå®‰å…¨å¯¾ç­–ã®æ¨å¥¨äº‹é …]

### ğŸ“ ç·Šæ€¥æ™‚é€£çµ¡å…ˆ
[é‡è¦åº¦é †ã®ç·Šæ€¥é€£çµ¡å…ˆãƒªã‚¹ãƒˆ]"""
    
    def _get_evaluation_guidelines(self) -> str:
        """è©•ä¾¡ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’å–å¾—"""
        return """## ğŸ“‹ è©•ä¾¡å®Ÿæ–½ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### ğŸ¯ è©•ä¾¡ã®åŸºæœ¬åŸå‰‡
1. **ãƒ‡ãƒ¼ã‚¿é§†å‹•å‹è©•ä¾¡**: æ„Ÿæƒ…çš„åˆ¤æ–­ã‚’æ’é™¤ã—ã€çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã¨äº‹å®Ÿã«åŸºã¥ãå®¢è¦³çš„è©•ä¾¡
2. **å¤šè§’çš„è¦–ç‚¹çµ±åˆ**: å„å°‚é–€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®è¦–ç‚¹ã‚’é©åˆ‡ã«é‡ã¿ä»˜ã‘ã—ã¦çµ±åˆ
3. **å®Ÿç”¨æ€§é‡è¦–**: æ—…è¡Œè€…ãŒå®Ÿéš›ã«ç›´é¢ã™ã‚‹ãƒªã‚¹ã‚¯ã«ç„¦ç‚¹ã‚’å½“ã¦ãŸå®Ÿè·µçš„è©•ä¾¡
4. **æ™‚ç³»åˆ—å¤‰åŒ–è€ƒæ…®**: éå»ã®ãƒˆãƒ¬ãƒ³ãƒ‰ã¨ç¾åœ¨ã®çŠ¶æ³ã‚’åˆ†æã—ãŸå‹•çš„è©•ä¾¡

### ğŸ”„ ç›¸äº’ä½œç”¨åˆ†æã®é‡è¦æ€§
- **ãƒ†ãƒ­ãƒªã‚¹ã‚¯Ã—æ²»å®‰çŠ¶æ³**: ãƒ†ãƒ­æ´»å‹•ãŒä¸€èˆ¬çŠ¯ç½ªç‡ã«ä¸ãˆã‚‹å½±éŸ¿ã‚’è©•ä¾¡
- **æ”¿æ²»ä¸å®‰Ã—æ³•åŸ·è¡Œ**: æ”¿æ²»æ··ä¹±ãŒè­¦å¯Ÿæ©Ÿèƒ½ã«ä¸ãˆã‚‹å½±éŸ¿ã‚’åˆ†æ
- **çµŒæ¸ˆçŠ¶æ³Ã—çŠ¯ç½ªç‡**: çµŒæ¸ˆæŒ‡æ¨™ã¨çŠ¯ç½ªç™ºç”Ÿç‡ã®ç›¸é–¢é–¢ä¿‚ã‚’è€ƒæ…®
- **ç¤¾ä¼šåŸºç›¤Ã—ç·Šæ€¥å¯¾å¿œ**: ã‚¤ãƒ³ãƒ•ãƒ©çŠ¶æ³ãŒç·Šæ€¥æ™‚å¯¾å¿œèƒ½åŠ›ã«ä¸ãˆã‚‹å½±éŸ¿ã‚’è©•ä¾¡

### ğŸ“Š ã‚¹ã‚³ã‚¢ç®—å‡ºã®ç²¾å¯†åŒ–
- **åœ°åŸŸå·®åˆ†æ**: é¦–éƒ½éƒ¨ã¨åœ°æ–¹éƒ¨ã§ã®å®‰å…¨ãƒ¬ãƒ™ãƒ«æ ¼å·®ã‚’åæ˜ 
- **å­£ç¯€å¤‰å‹•è€ƒæ…®**: è¦³å…‰ã‚·ãƒ¼ã‚ºãƒ³ã‚„æ”¿æ²»ã‚¤ãƒ™ãƒ³ãƒˆæ™‚æœŸã®å½±éŸ¿ã‚’åŠ å‘³
- **ç‰¹å®šé›†å›£ãƒªã‚¹ã‚¯**: å¤–å›½äººè¦³å…‰å®¢ãŒç‰¹ã«æ³¨æ„ã™ã¹ããƒªã‚¹ã‚¯è¦å› ã‚’å¼·èª¿
- **ç·Šæ€¥äº‹æ…‹å¯¾å¿œ**: è‡ªç„¶ç½å®³ã‚„çªç™ºçš„äº‹ä»¶ã¸ã®å¯¾å¿œèƒ½åŠ›ã‚’è©•ä¾¡

### ğŸš¨ æè¨€ã®å…·ä½“æ€§è¦ä»¶
- **æ®µéšåˆ¥å¯¾ç­–**: ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ãŸæ®µéšçš„å®‰å…¨å¯¾ç­–ã®æç¤º
- **åœ°åŸŸåˆ¥æ³¨æ„ç‚¹**: ã‚¨ãƒªã‚¢æ¯ã®å…·ä½“çš„ãªæ³¨æ„äº‹é …ã¨å›é¿ã™ã¹ãå ´æ‰€
- **æ™‚é–“å¸¯åˆ¥ãƒªã‚¹ã‚¯**: æ™‚é–“å¸¯ã‚„æ›œæ—¥ã«ã‚ˆã‚‹å®‰å…¨æ€§ã®å¤‰åŒ–ã‚’æ˜ç¤º
- **ç·Šæ€¥æ™‚è¡Œå‹•è¨ˆç”»**: å…·ä½“çš„ãªç·Šæ€¥æ™‚å¯¾å¿œæ‰‹é †ã¨é€£çµ¡å…ˆæƒ…å ±ã®æä¾›

### ğŸ” å“è³ªãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ
- ã™ã¹ã¦ã®è©•ä¾¡é …ç›®ã«å¯¾ã—ã¦æ˜ç¢ºãªæ ¹æ‹ ã‚’æç¤º
- æ•°å€¤çš„è©•ä¾¡ã¨å®šæ€§çš„åˆ†æã®ãƒãƒ©ãƒ³ã‚¹ã‚’ä¿æŒ
- æœ€æ–°ã®æƒ…å‹¢å¤‰åŒ–ã‚’é©åˆ‡ã«åæ˜ 
- åˆ©ç”¨è€…ã®å®‰å…¨ç¢ºä¿ã‚’æœ€å„ªå…ˆã¨ã—ãŸå®Ÿè·µçš„æè¨€ã®æä¾›"""
    
    def get_safety_level(self, total_score: int) -> str:
        """ç·åˆã‚¹ã‚³ã‚¢ã‹ã‚‰å®‰å…¨ãƒ¬ãƒ™ãƒ«ã‚’åˆ¤å®š"""
        if total_score >= self.thresholds.EXCELLENT:
            return self.levels.EXCELLENT
        elif total_score >= self.thresholds.GOOD:
            return self.levels.GOOD
        elif total_score >= self.thresholds.AVERAGE:
            return self.levels.AVERAGE
        elif total_score >= self.thresholds.CAUTION:
            return self.levels.CAUTION
        else:
            return self.levels.DANGEROUS
    
    def validate_scores(self, scores: Dict[str, int]) -> bool:
        """ã‚¹ã‚³ã‚¢ã®å¦¥å½“æ€§ã‚’æ¤œè¨¼"""
        if len(scores) != NUM_CATEGORIES:
            return False
        
        for category, score in scores.items():
            if not (0 <= score <= MAX_SCORE_PER_CATEGORY):
                return False
        
        return True
    
    def calculate_total_score(self, scores: Dict[str, int]) -> int:
        """å„ã‚«ãƒ†ã‚´ãƒªã®ã‚¹ã‚³ã‚¢ã‹ã‚‰ç·åˆã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—"""
        if not self.validate_scores(scores):
            raise ValueError("Invalid scores provided")
        
        return sum(scores.values())
    
    def synthesize_safety_report(self, 
                               conflict_info: str,
                               crime_info: str,
                               infra_info: str,
                               law_info: str) -> str:
        """å®‰å…¨æƒ…å ±ã‚’çµ±åˆã—ã¦ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ"""
        prompt_data = {
            "conflict_info": conflict_info,
            "crime_info": crime_info,
            "infra_info": infra_info,
            "law_info": law_info
        }
        
        return self.agent.generate_response(prompt_data)


# ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆï¼ˆå¾Œæ–¹äº’æ›æ€§ã®ãŸã‚ï¼‰
synthesizer_agent = SafetyScoreSynthesizerAgent()
safety_score_synthesizer = synthesizer_agent.agent